---
title: Integración con Android
description: A continuación se muestra cómo se ha organizado la generación del análisis.
---
## Configuración básica
Respecto a las empresas del sector, he encontrado una que tiene un asistente de integración. En concreto [AppsFlyer](https://dj.dev.appsflyer.com/).
Creo que EMMA podría hacer algo similar para facilitar todo el proceso de integración a los desarrolladores.

## Integración y gestión de dependencias
Comenzamos la integración del SDK siguiendo las indicaciones de la [documentación](https://developer.emma.io/es/android/integracion-sdk). Para ello, creamos un proyecto en
Android Studio con la propiedad Empty Views Activity, en Kotlin, con el SDK mínimo API 24 (“Nougat”, Android 7.0 ) y
usando Kotlin DSL.

Al introducir el repositorio, no se especifica en qué bloque debe de ir. Dado que es un repositorio, creo que deberíamos
de indicarlo de la siguiente forma:
```kotlin title="settings.gradle.kts(:project)"
dependencyResolutionManagement {
    repositories {
        maven("https://repo.emma.io/emma")
    }
}
```
<Info>
Quizás, para desarrolladores poco experimentados sea más claro especificar todas las etiquetas padre. Además, veo que la
documentación menciona el repositorio con el formato de bloque. Si solo se incluye el repositorio y no se configura nada
más, podría sustituirse por la versión simplificada (la que he puesto). También creo que hay que corregir el párrafo
donde se menciona este repositorio, puesto que hace mención al fichero `build.gradle` y, en realidad, iría en `settings.gradle`.
</Info>

A continuación, respecto a las dependencias que se mencionan, considero que se podría utilizar la sintaxis de versiones
de catálogo. Es una recomendación que hace el IDE y se simplifica mucho la sintaxis. Si se usa la versión de catálogo es
cierto que hay que mostrar la configuración del fichero libs.versions.toml y puede ser más engorroso. Además, convendría
eliminar el uso de “+” en las invocaciones de dependencias, puede resultar inestable según nos recomienda el IDE. Por lo
que cambiaría el código a la siguiente forma:
```kotlin title="settings.gradle.kts (:app)"
dependencies {
  implementation(libs.emmasdk)
}
```
```kotlin title="libs.versions.toml"
[version]
emmasdk = "4.15.4"

[libraries]
emmasdk = { module = "io.emma:eMMaSDK", version.ref = "emmasdk" }
```
A continuación, en el epígrafe de integración básica se menciona la clave de sesión pero no se utiliza hasta varios
epígrafes después. Así que no lo mencionaría hasta entonces.

### Ofuscación
Creo que el apartado actual de ProGuard que hay actualmente, se puede renombrar por Ofuscación y ponerlo dentro del
apartado Integración básica. A pesar de esto y, en comparación con otras fuentes de documentación, las reglas que se
proporcionan son relativamente claras. Si bien es cierto que no se menciona nada sobre R8 (la herramienta de ofuscación
de Android), pero en términos generales creo que está bien este apartado.

### Referencias en la instalación
En la documentación de integración no se observa ningún punto donde se mencionen las referencias de instalación,
como sí hacen [Adjust](https://dev.adjust.com/en/sdk/android#set-up-install-referrer) y [AppsFlyer](https://dev.appsflyer.com/hc/docs/install-android-sdk#adding-store-referrer-libraries).

### Permisos requeridos
Respecto a los permisos requeridos del SDK, aquellos que trae por defecto no los incluiría dentro de un bloque de código.
Simplemente, los mencionaría. Quizás, ver el bloque de código induce a no leer el párrafo de arriba y directamente
copiar el código. Solo dejaría el bloque de código que es necesario poner.

Además, en el apartado se incluye por defecto la identificación de anuncios, pero no se menciona la Ley de Protección de
la Privacidad en Línea para Niños (COPPA) como sí se hace en la documentación de [Adjust](https://dev.adjust.com/en/sdk/android#add-permissions)
o [AppsFlyer](https://dev.appsflyer.com/hc/docs/install-android-sdk#the-ad_id-permission).

### Integración de Huawei
En cuanto a la sección de Huawei, parece que su configuración tiene varios pasos más que otros proveedores. Por la
disposición de la documentación, me ha costado identificar qué partes son de Huawei y cuáles son genéricas para Android.
Sobre todo las primeras veces que consulté la documentación. Quizás estaría bien separar la implementación de Huawei en
una página a parte (donde se explique toda la implementación desde cero) o bien poner un bloque de texto (de un color
diferente al fondo de la documentación) desplegable.

También se usan direcciones URL con protocolo HTTP que Android Studio las reconoce como inseguras. Ante esto tenemos dos
opciones, seguir usando la URL insegura o usar URL HTTPS. A continuación, se muestra un ejemplo explicativo con las líneas
necesarias.

<Card title="Configuración de conexión HTTP y HTTPS">
Se debe incluir una instrucción específica para permitir a Gradle la conexión con repositorios inseguros. Es útil para
repositorios que no dispongan de conexión HTTP. En la documentación no se menciona nada de esta configuración y da error
al construir el proyecto.
```kotlin title="build.gradle (:proyect)"
buildscript {
    repositories {
        google()
        mavenCentral()
        maven {
            url = uri("http://developer.huawei.com/repo/")
            isAllowInsecureProtocol = true
        }
    }
}
```
Se modifica la URL para que sea HTTPS, evita usar configuraciones como las del caso anterior.
```kotlin title="build.gradle (:proyect)"
buildscript {
    repositories {
        google()
        mavenCentral()
        maven("https://developer.huawei.com/repo/")
    }
}
```
</Card>
En el bloque de código, no se especifica qué fichero build es donde van las dependencias y no se usan versiones de catálogo,
por lo que sugiero cambiarlo a algo como así:

Se puede observar que no se incluye el bloque allprojects{}. Este bloque ya no se usa, así que lo he eliminado.

```kotlin title="build.gradle (:project)"
buildscript {
    repositories {
        google()
        mavenCentral()
        maven("https://developer.huawei.com/repo/")
    }
    dependencies {
        classpath(libs.gradle)
        classpath(libs.agcp)
    }
}
```
Importante poner bien las versiones o, en su defecto, poner “latest version”. Con eso evitamos errores a la hora de
construir el proyecto y que pueda creerse que se deben a otras cosas.
```kotlin title="libs.versions.toml "
[version]
agcp = "1.9.1.301"
gradle = "8.9.1"

[libraries]
agcp = { module = "com.huawei.agconnect:agcp", version.ref = "agcp" }
gradle = { module = "com.android.tools.build:gradle", version.ref = "gradle" }
```
Respecto al fichero de dependencias de la aplicación, se usa una sintaxis para aplicar el plugin, que actualmente no es
válida. La línea indicada en la documentación tiene que ir dentro de otro bloque. Tal y como se indica a continuación.
```kotlin title="build.gradle (:app)"
plugins { // [!code ++]
    id("com.huawei.agconnect") // [!code ++]
} // [!code ++]

dependencies {
    // other dependencies // [!code --]
    implementation 'com.huawei.hms:ads-identifier:3.4.62.300' // [!code --]
    implementation(libs.ads.identifier) // [!code ++]
}
apply plugin: 'com.huawei.agconnect' // [!code --]

```
```kotlin title="libs.versions.toml "
[versions]
adsIdentifier = "3.4.62.300"

[libraries]
ads-identifier = { module = "com.huawei.hms:ads-identifier", version.ref = "adsIdentifier" }
```

Considero que puede ser útil mencionar o recomendar la consulta de las últimas versiones de las dependencias usadas,
con el fin de no generar conflictos. A lo largo de la documentación se usan muchas dependencias, por lo que se podría
usar un apartado de “Referencias” o similar para listar todas las dependencias y un enlace a su historial de versiones.
Un ejemplo sería la versión del SDK de
[AGCP](https://developer.huawei.com/consumer/en/doc/AppGallery-connect-Guides/agc-sdk-changenotes-0000001058732550#section1850181717218)
y [Gradle](https://gradle.org/releases/).

<Warning>No he continuado con la configuración de Huawei.</Warning>

### Inicialización de la librería
En este [punto](https://developer.emma.io/es/android/integracion-sdk#inicializar-la-librer%C3%ADa), no hay ninguna explicación de por qué se proporciona directamente el código de la clase Application.
Es decir, si comparamos con la documentación de [AppsFlyer](https://support.appsflyer.com/hc/es/articles/207032066-Gu%C3%ADa-b%C3%A1sica-de-integraci%C3%B3n-del-SDK#select-in-what-class-to-start-the-sdk), se explica que el SDK se puede iniciar desde la clase
Application (para un inicio inmediato) o desde la clase Activity (para un inicio aplazado), así como los motivos. En el
apartado de [inicio aplazado del SDK](https://developer.emma.io/es/android/integracion-sdk#aplazar-el-inicio-del-sdk-opcional), no se explica tampoco.

Respecto al inicio aplazado, en este [punto](https://developer.emma.io/es/android/integracion-sdk#aplazar-el-inicio-del-sdk-opcional),
no se explica la razón por la cual se debe de aplazar el inicio del SDK. Si lo comparamos con la documentación de
[AppsFlyer](https://support.appsflyer.com/hc/es/articles/207032066-Gu%C3%ADa-b%C3%A1sica-de-integraci%C3%B3n-del-SDK#where-to-start-the-sdk),
en su documentación sí tienen un pequeño párrafo en el que explican la razón por la que se tendría que aplazar el inicio,
que es por políticas de privacidad.

### Privacidad
En comparación con otras fuentes de documentación
([estrategia de preservación de la privacidad](https://support.appsflyer.com/hc/es/articles/207032066-Gu%C3%ADa-b%C3%A1sica-de-integraci%C3%B3n-del-SDK#select-the-optoutin-scenario::ae4c6e25)
y [métodos de preservación de privacidad](https://support.appsflyer.com/hc/es/articles/360001422989-M%C3%A9todos-de-preservaci%C3%B3n-de-la-privacidad-en-el-SDK),
la integración en Android no tiene un apartado de privacidad dedicado. El apartado que más se le asemeja es el de
[Manifiesto de la Privacidad](https://developer.emma.io/es/ios/privacy-manifest), pero tiene el icono de Apple y su
contenido está mezclado con varias plataformas (entre las cuales no encuentro Android).

![diagrama_uml](/pascual/images/uml.png)

<Image src="/pascual/images/uml.png" alt="Pretty picture" width="100" height="100" />


## Powlinks
## Notificaciones push
### Configuración de Firebase
## Integración behavior
### Registro e inicio de sesión de usuarios
### Transacciones
### Eventos personalizados
## Perfil de usuario
### Atribución
## Opciones avanzadas
### ProGuard
## Integración In-App Messaging
### NativeAds
### StartViews, Adball, Banner y StripView
### Cupones
## Plugins personalizados
## Revisión de enlaces caídos o rotos
